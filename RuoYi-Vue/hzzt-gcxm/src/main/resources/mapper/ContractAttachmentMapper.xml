<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.hzzt.mapper.ContractAttachmentMapper">
    
    <resultMap type="com.hzzt.domain.ContractAttachment" id="ContractAttachmentResult">
        <result property="id"                   column="id" />
        <result property="contractId"           column="contract_id" />
        <result property="fileName"             column="file_name" />
        <result property="fileOriginalName"     column="file_original_name" />
        <result property="filePath"             column="file_path" />
        <result property="fileSize"             column="file_size" />
        <result property="fileType"             column="file_type" />
        <result property="fileExtension"        column="file_extension" />
        <result property="fileCategory"         column="file_category" />
        <result property="uploadUser"           column="upload_user" />
        <result property="uploadTime"           column="upload_time" />
        <result property="isMain"               column="is_main" />
        <result property="sortOrder"            column="sort_order" />
        <result property="remark"               column="remark" />
        <result property="createBy"             column="create_by" />
        <result property="createTime"           column="create_time" />
        <result property="updateBy"             column="update_by" />
        <result property="updateTime"           column="update_time" />
        <result property="delFlag"              column="del_flag" />
    </resultMap>

    <sql id="selectContractAttachmentVo">
        select id, contract_id, file_name, file_original_name, file_path, file_size, file_type, file_extension, 
               file_category, upload_user, upload_time, is_main, sort_order, remark, create_by, create_time, 
               update_by, update_time, del_flag 
        from contract_attachment
    </sql>

    <select id="selectContractAttachmentList" parameterType="com.hzzt.domain.ContractAttachment" resultMap="ContractAttachmentResult">
        <include refid="selectContractAttachmentVo"/>
        <where>
            del_flag = '0'
            <if test="contractId != null "> and contract_id = #{contractId}</if>
            <if test="fileName != null  and fileName != ''"> and file_name like concat('%', #{fileName}, '%')</if>
            <if test="fileOriginalName != null  and fileOriginalName != ''"> and file_original_name like concat('%', #{fileOriginalName}, '%')</if>
            <if test="fileType != null  and fileType != ''"> and file_type = #{fileType}</if>
            <if test="fileCategory != null  and fileCategory != ''"> and file_category = #{fileCategory}</if>
            <if test="uploadUser != null  and uploadUser != ''"> and upload_user like concat('%', #{uploadUser}, '%')</if>
            <if test="isMain != null  and isMain != ''"> and is_main = #{isMain}</if>
        </where>
        order by sort_order asc, create_time desc
    </select>
    
    <select id="selectAttachmentsByContractId" parameterType="Long" resultMap="ContractAttachmentResult">
        <include refid="selectContractAttachmentVo"/>
        where contract_id = #{contractId} and del_flag = '0'
        order by sort_order asc, create_time desc
    </select>

    <delete id="deleteContractAttachmentByIds" parameterType="String">
        update contract_attachment set del_flag = '2' where id in 
        <foreach item="id" collection="array" open="(" separator="," close=")">
            #{id}
        </foreach>
    </delete>

    <delete id="deleteAttachmentsByContractId" parameterType="Long">
        update contract_attachment set del_flag = '2' where contract_id = #{contractId}
    </delete>

</mapper>
